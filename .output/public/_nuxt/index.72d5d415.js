import{_ as I,f as E,k as n,l as i,q as M,z as c,t as _,m as a,A as F,B as O,x as w,y as C,v as x,d as j,r as S,C as z,D as P,o as V,E as Y,F as A,G,H as k,I as R,J as U,K as J,L as y,M as K,N as W}from"./entry.df70887b.js";import{u as B}from"./chat.8932fb89.js";import"./axios.f72bf569.js";const Q=""+new URL("loading-dot.093b62ac.gif",import.meta.url).href;const X=t=>(w("data-v-e9587081"),t=t(),C(),t),Z={key:0,class:"chat-profile"},tt=X(()=>a("div",null,"도슨트",-1)),et={key:1,class:"chat-date"},nt={key:2,class:"chat-box loading"},ot=["src"],st={key:3,class:"chat-box"},at={__name:"ChatBox",props:{type:{type:String,required:!1,default:"text"},text:{type:String,required:!1,default:""}},setup(t){return(o,e)=>{const s=E("v-icon");return n(),i("div",{class:O(["chat-box-wrapper",{right:t.type==="text"}])},[t.type==="docent"?(n(),i("div",Z,[M(s,{class:"ic_docent"}),tt])):c("",!0),t.type==="date"?(n(),i("div",et,_(o.$dayjs(t.text).format("YYYY년 M월 D일")),1)):c("",!0),t.type==="loading"?(n(),i("div",nt,[a("img",{src:F(Q)},null,8,ot)])):c("",!0),t.type==="text"?(n(),i("div",st,_(t.text),1)):c("",!0)],2)}}},b=I(at,[["__scopeId","data-v-e9587081"]]);const it={name:"ChatResult",props:{type:{type:Number,required:!0,default:1},chat:{type:Object,required:!0,default:()=>{}}},computed:{type_name(){switch(this.type){case 1:return"🌞 아침 일기";case 2:return"🌙 저녁 일기";case 3:return"✏️ 메모";default:return"✅ 일정"}}},methods:{more(){console.log("cliclk>>",this.chat);const t=this.chat.content_type===1?this.chat.MorningDiary_id:this.chat.NightDiary_id;console.log(`type: ${this.chat.content_type} id: ${t}`),this.$router.push(`/diary/${t}?type=${this.chat.content_type}`)}}},D=t=>(w("data-v-b209a8a4"),t=t(),C(),t),ct={class:"chat-result"},lt={key:0,class:"chat-title"},rt={key:1,class:"chat-title"},dt={key:2,class:"memo"},ut={class:"chat-diary-title"},_t=["src"],pt={key:3},ht={class:"chat-memo"},mt=D(()=>a("div",{class:"chat-more"},"더 알아보기 >",-1)),yt={key:4},ft={class:"chat-calendar"},gt={class:"chat-calendar-title"},vt={class:"date"},xt=D(()=>a("button",{class:"button"},"자세히 보기",-1));function kt(t,o,e,s,m,d){return n(),i("div",ct,[e.type===4?(n(),i("div",lt,[a("span",null,_(d.type_name.replace(" ","  ")),1),x("이 추가 되었습니다! ")])):(n(),i("div",rt,[a("span",null,_(d.type_name.replace(" ","  ")),1),x("가 추가 되었습니다! ")])),e.type===1||e.type===2?(n(),i("div",dt,[a("div",ut,_(e.chat.content),1),a("img",{src:e.chat.image_url},null,8,_t),a("div",{class:"chat-more",onClick:o[0]||(o[0]=(...r)=>d.more&&d.more(...r))},"더 알아보기 >")])):c("",!0),e.type===3?(n(),i("div",pt,[a("div",ht,[x(_(e.chat.content)+" ",1),mt])])):c("",!0),e.type===4?(n(),i("div",yt,[a("div",ft,[a("div",gt,_(e.chat.content),1),a("div",vt,_(t.$dayjs(e.chat.event_time).format("MM.DD ddd"))+"요일 ",1)]),xt])):c("",!0)])}const bt=I(it,[["render",kt],["__scopeId","data-v-b209a8a4"]]);function It(t,o){const e=t.getBoundingClientRect();if(!o)return e.top>=0&&e.bottom<=window.innerHeight;const s=o.getBoundingClientRect();return e.top>=s.top&&e.bottom<=s.bottom}async function wt(t){return await R(),t.value instanceof HTMLElement?t.value:t.value?document.querySelector(t.value):null}function T(t){let o=`0px 0px ${t.distance}px 0px`;t.top&&(o=`${t.distance}px 0px 0px 0px`);const e=new IntersectionObserver(s=>{s[0].isIntersecting&&(t.firstload&&t.emit(),t.firstload=!0)},{root:t.parentEl,rootMargin:o});return e.observe(t.infiniteLoading.value),e}const N=(t,o)=>{const e=t.__vccOpts||t;for(const[s,m]of o)e[s]=m;return e},Ct={},$t=t=>(w("data-v-d3e37633"),t=t(),C(),t),Lt={class:"container"},St=$t(()=>a("div",{class:"spinner"},null,-1)),Bt=[St];function Tt(t,o){return n(),i("div",Lt,Bt)}const Et=N(Ct,[["render",Tt],["__scopeId","data-v-d3e37633"]]),Mt={class:"state-error"},Rt=j({__name:"InfiniteLoading",props:{top:{type:Boolean,default:!1},target:{},distance:{default:0},identifier:{},firstload:{type:Boolean,default:!0},slots:{}},emits:["infinite"],setup(t,{emit:o}){const e=t;let s=null,m=0;const d=S(null),r=S(""),{top:h,firstload:v,distance:g}=e,{identifier:l,target:H}=z(e),u={infiniteLoading:d,top:h,firstload:v,distance:g,parentEl:null,emit(){m=(u.parentEl||document.documentElement).scrollHeight,$.loading(),o("infinite",$)}},$={loading(){r.value="loading"},async loaded(){r.value="loaded";const p=u.parentEl||document.documentElement;await R(),h&&(p.scrollTop=p.scrollHeight-m),It(d.value,u.parentEl)&&u.emit()},complete(){r.value="complete",s==null||s.disconnect()},error(){r.value="error"}};return P(l,()=>{s==null||s.disconnect(),s=T(u)}),V(async()=>{u.parentEl=await wt(H),s=T(u)}),Y(()=>{s==null||s.disconnect()}),(p,L)=>(n(),i("div",{ref_key:"infiniteLoading",ref:d,style:{"min-height":"1px"}},[A(a("div",null,[k(p.$slots,"spinner",{},()=>[M(Et)],!0)],512),[[G,r.value=="loading"]]),r.value=="complete"?k(p.$slots,"complete",{key:0},()=>{var f;return[a("span",null,_(((f=p.slots)==null?void 0:f.complete)||"No more results!"),1)]},!0):c("",!0),r.value=="error"?k(p.$slots,"error",{key:1,retry:u.emit},()=>{var f;return[a("span",Mt,[a("span",null,_(((f=p.slots)==null?void 0:f.error)||"Oops something went wrong!"),1),a("button",{class:"retry",onClick:L[0]||(L[0]=(...q)=>u.emit&&u.emit(...q))},"retry")])]},!0):c("",!0)],512))}}),Dt=N(Rt,[["__scopeId","data-v-a7077831"]]);const Nt={name:"Chat",components:{InfiniteLoading:Dt,ChatBox:b,ChatResult:b},setup(){},data(){return{isInitialized:!1}},computed:{...U(B,["list","chatList","totalCounts","pageNo","reload"])},watch:{list(){this.listToChatList()},reload(){if(console.log(this.reload),this.reload){console.log("스크롤 실행!");const t=this.$refs.scrollable,o=t.scrollHeight;console.log("*",t.scrollTop,", ",o),t.scrollTo({top:o,behavior:"smooth"}),t.addEventListener("scroll",()=>{const e=t.scrollTop+t.clientHeight>=o-.5;console.log(" check -> ",t.scrollTop+t.clientHeight,", ",o-.5),e&&this.setReload(!1)})}}},mounted(){if(console.log(window.localStorage.getItem("accessToken")),!window.localStorage.getItem("accessToken")){console.log(this.$eventBus),this.$eventBus.$emit("onLoginModal");return}this.getFirstPage()},methods:{...J(B,["getList","listToChatList","getFirstPage","setIsFirstPage","setReload"]),async loadMore(){console.log("here"),this.$nextTick(),setTimeout(()=>{this.totalCounts>this.list.length&&this.getList()},1e3)}}},Ht={class:"contents",ref:"scrollable"};function qt(t,o,e,s,m,d){var g;const r=E("infinite-loading"),h=b,v=bt;return n(),i("div",Ht,[(g=t.chatList)!=null&&g.length?(n(),y(r,{key:0,"first-load":!1,distance:1e3,top:!0,onInfinite:d.loadMore},null,8,["onInfinite"])):c("",!0),(n(!0),i(K,null,W(t.chatList,l=>(n(),i("div",{key:l.id},[l.content_type===5?(n(),y(h,{key:0,type:"docent"})):c("",!0),l.content_type===7?(n(),y(h,{key:1,type:"loading"})):c("",!0),l.content_type===6?(n(),y(h,{key:2,text:l.content,type:"date"},null,8,["text"])):c("",!0),l.is_chatbot&&[1,2,3,4].includes(l.content_type)?(n(),y(v,{key:3,type:l.content_type,chat:l},null,8,["type","chat"])):c("",!0),!l.is_chatbot&&[1,2,3,4,null].includes(l.content_type)?(n(),y(h,{key:4,text:l.content},null,8,["text"])):c("",!0)]))),128))],512)}const zt=I(Nt,[["render",qt],["__scopeId","data-v-4d28c199"]]);export{zt as default};
