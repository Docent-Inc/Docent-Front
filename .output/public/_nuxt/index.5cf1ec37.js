import{_ as I,f as B,k as n,l as i,q as E,z as c,t as _,m as a,A as O,B as q,x as C,y as w,v as x,d as z,r as S,C as j,D as F,o as V,E as A,F as G,G as U,H as b,I as M,J as Y,K as P,L as y,M as K,N as W}from"./entry.cf959fc5.js";import{u as N}from"./chat.4d527f48.js";import"./axios.f72bf569.js";const Z=""+new URL("loading-dot.093b62ac.gif",import.meta.url).href;const X=t=>(C("data-v-4bb6aed7"),t=t(),w(),t),Q={key:0,class:"chat-profile"},tt=X(()=>a("div",null,"도슨트",-1)),et={key:1,class:"chat-date"},nt={key:2,class:"chat-box loading"},ot=["src"],st={key:3,class:"chat-box"},at={__name:"ChatBox",props:{type:{type:String,required:!1,default:"text"},text:{type:String,required:!1,default:""}},setup(t){return(o,e)=>{const s=B("v-icon");return n(),i("div",{class:q(["chat-box-wrapper",{right:t.type==="text"}])},[t.type==="docent"?(n(),i("div",Q,[E(s,{class:"ic_docent"}),tt])):c("",!0),t.type==="date"?(n(),i("div",et,_(o.$dayjs(t.text).format("YYYY년 M월 D일")),1)):c("",!0),t.type==="loading"?(n(),i("div",nt,[a("img",{src:O(Z)},null,8,ot)])):c("",!0),t.type==="text"?(n(),i("div",st,_(t.text),1)):c("",!0)],2)}}},k=I(at,[["__scopeId","data-v-4bb6aed7"]]);const it={name:"ChatResult",props:{type:{type:Number,required:!0,default:1},chat:{type:Object,required:!0,default:()=>{}}},computed:{type_name(){switch(this.type){case 1:return"🌞 아침 일기";case 2:return"🌙 저녁 일기";case 3:return"✏️ 메모";default:return"✅ 일정"}}},methods:{more(){console.log("cliclk>>",this.chat);const t=this.chat.content_type===1?this.chat.MorningDiary_id:this.chat.NightDiary_id;console.log(`type: ${this.chat.content_type} id: ${t}`),this.$router.push(`/diary/${t}?type=${this.chat.content_type}`)}}},R=t=>(C("data-v-b9a82f53"),t=t(),w(),t),ct={class:"chat-result"},lt={key:0,class:"chat-title"},rt={key:1,class:"chat-title"},dt={key:2,class:"memo"},ut={class:"chat-diary-title"},_t=["src"],pt={key:3},ht={class:"chat-memo"},mt=R(()=>a("div",{class:"chat-more"},"더 알아보기 >",-1)),yt={key:4},ft={class:"chat-calendar"},vt={class:"chat-calendar-title"},gt={class:"date"},xt=R(()=>a("button",{class:"button"},"자세히 보기",-1));function bt(t,o,e,s,m,d){return n(),i("div",ct,[e.type===4?(n(),i("div",lt,[a("span",null,_(d.type_name.replace(" ","  ")),1),x("이 추가 되었습니다! ")])):(n(),i("div",rt,[a("span",null,_(d.type_name.replace(" ","  ")),1),x("가 추가 되었습니다! ")])),e.type===1||e.type===2?(n(),i("div",dt,[a("div",ut,_(e.chat.content),1),a("img",{src:e.chat.image_url},null,8,_t),a("div",{class:"chat-more",onClick:o[0]||(o[0]=(...r)=>d.more&&d.more(...r))},"더 알아보기 >")])):c("",!0),e.type===3?(n(),i("div",pt,[a("div",ht,[x(_(e.chat.content)+" ",1),mt])])):c("",!0),e.type===4?(n(),i("div",yt,[a("div",ft,[a("div",vt,_(e.chat.content),1),a("div",gt,_(t.$dayjs(e.chat.event_time).format("MM.DD ddd"))+"요일 ",1)]),xt])):c("",!0)])}const kt=I(it,[["render",bt],["__scopeId","data-v-b9a82f53"]]);function It(t,o){const e=t.getBoundingClientRect();if(!o)return e.top>=0&&e.bottom<=window.innerHeight;const s=o.getBoundingClientRect();return e.top>=s.top&&e.bottom<=s.bottom}async function Ct(t){return await M(),t.value instanceof HTMLElement?t.value:t.value?document.querySelector(t.value):null}function T(t){let o=`0px 0px ${t.distance}px 0px`;t.top&&(o=`${t.distance}px 0px 0px 0px`);const e=new IntersectionObserver(s=>{s[0].isIntersecting&&(t.firstload&&t.emit(),t.firstload=!0)},{root:t.parentEl,rootMargin:o});return e.observe(t.infiniteLoading.value),e}const D=(t,o)=>{const e=t.__vccOpts||t;for(const[s,m]of o)e[s]=m;return e},wt={},Lt=t=>(C("data-v-d3e37633"),t=t(),w(),t),$t={class:"container"},St=Lt(()=>a("div",{class:"spinner"},null,-1)),Nt=[St];function Tt(t,o){return n(),i("div",$t,Nt)}const Bt=D(wt,[["render",Tt],["__scopeId","data-v-d3e37633"]]),Et={class:"state-error"},Mt=z({__name:"InfiniteLoading",props:{top:{type:Boolean,default:!1},target:{},distance:{default:0},identifier:{},firstload:{type:Boolean,default:!0},slots:{}},emits:["infinite"],setup(t,{emit:o}){const e=t;let s=null,m=0;const d=S(null),r=S(""),{top:h,firstload:g,distance:v}=e,{identifier:l,target:H}=j(e),u={infiniteLoading:d,top:h,firstload:g,distance:v,parentEl:null,emit(){m=(u.parentEl||document.documentElement).scrollHeight,L.loading(),o("infinite",L)}},L={loading(){r.value="loading"},async loaded(){r.value="loaded";const p=u.parentEl||document.documentElement;await M(),h&&(p.scrollTop=p.scrollHeight-m),It(d.value,u.parentEl)&&u.emit()},complete(){r.value="complete",s==null||s.disconnect()},error(){r.value="error"}};return F(l,()=>{s==null||s.disconnect(),s=T(u)}),V(async()=>{u.parentEl=await Ct(H),s=T(u)}),A(()=>{s==null||s.disconnect()}),(p,$)=>(n(),i("div",{ref_key:"infiniteLoading",ref:d,style:{"min-height":"1px"}},[G(a("div",null,[b(p.$slots,"spinner",{},()=>[E(Bt)],!0)],512),[[U,r.value=="loading"]]),r.value=="complete"?b(p.$slots,"complete",{key:0},()=>{var f;return[a("span",null,_(((f=p.slots)==null?void 0:f.complete)||"No more results!"),1)]},!0):c("",!0),r.value=="error"?b(p.$slots,"error",{key:1,retry:u.emit},()=>{var f;return[a("span",Et,[a("span",null,_(((f=p.slots)==null?void 0:f.error)||"Oops something went wrong!"),1),a("button",{class:"retry",onClick:$[0]||($[0]=(...J)=>u.emit&&u.emit(...J))},"retry")])]},!0):c("",!0)],512))}}),Rt=D(Mt,[["__scopeId","data-v-a7077831"]]);const Dt={name:"Chat",components:{InfiniteLoading:Rt,ChatBox:k,ChatResult:k},setup(){},data(){return{isInitialized:!1}},computed:{...Y(N,["list","chatList","totalCounts","pageNo","reload"])},watch:{list(){this.listToChatList()},reload(){if(console.log(this.reload),this.reload){console.log("스크롤 실행!");const t=this.$refs.scrollable,o=t.scrollHeight;console.log("*",t.scrollTop,", ",o),t.scrollTo({top:o,behavior:"smooth"}),t.addEventListener("scroll",()=>{const e=t.scrollTop+t.clientHeight>=o-.5;console.log(" check -> ",t.scrollTop+t.clientHeight,", ",o-.5),e&&this.setReload(!1)})}}},mounted(){window.localStorage.setItem("accessToken","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJzdHJpbmciLCJleHAiOjIwNTM1NDcxNzZ9.Dqf6UOvR-OlKY6cVMjoN0AJ25stW8ojdSy2GZ5dyHlc"),this.getFirstPage()},methods:{...P(N,["getList","listToChatList","getFirstPage","setIsFirstPage","setReload"]),async loadMore(){this.reload||(this.$nextTick(),setTimeout(()=>{this.totalCounts>this.list.length&&this.getList()},1e3))}}},Ht={id:"chat-scrollable",ref:"scrollable"};function Jt(t,o,e,s,m,d){var v;const r=B("infinite-loading"),h=k,g=kt;return n(),i("div",Ht,[(v=t.chatList)!=null&&v.length?(n(),y(r,{key:0,"first-load":!1,distance:1e3,top:!0,onInfinite:d.loadMore},null,8,["onInfinite"])):c("",!0),(n(!0),i(K,null,W(t.chatList,l=>(n(),i("div",{key:l.id},[l.content_type===5?(n(),y(h,{key:0,type:"docent"})):c("",!0),l.content_type===7?(n(),y(h,{key:1,type:"loading"})):c("",!0),l.content_type===6?(n(),y(h,{key:2,text:l.content,type:"date"},null,8,["text"])):c("",!0),l.is_chatbot&&[1,2,3,4].includes(l.content_type)?(n(),y(g,{key:3,type:l.content_type,chat:l},null,8,["type","chat"])):c("",!0),!l.is_chatbot&&[1,2,3,4,null].includes(l.content_type)?(n(),y(h,{key:4,text:l.content},null,8,["text"])):c("",!0)]))),128))],512)}const jt=I(Dt,[["render",Jt],["__scopeId","data-v-b1daa504"]]);export{jt as default};
